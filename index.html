<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBS Alert Overlay</title>
    <style>
        /* Import Font */
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap');

        /* Reset & Body (Transparan untuk OBS) */
        body {
            margin: 0;
            padding: 0;
            background-color: transparent;
            font-family: 'Open Sans', sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alert muncul dari atas */
            height: 100vh;
        }

        /* --- CSS TAMPILAN --- */
        .alert {
            font-family: 'Open Sans', sans-serif !important;
            font-weight: 800;
            text-align: center;
            padding-top: 10px;
            text-shadow: 0 0 1px #000, 0 0 2px #000, 0 0 3px #000, 0 0 4px #000, 0 0 5px #000;
            width: 100%;
            max-width: 400px; 
            box-sizing: border-box;
            
            opacity: 0; /* Default sembunyi */
            transition: none !important;
            animation: none !important;
        }

        .media {
            max-width: 100%; 
            height: auto;
            border-radius: 10px;
            margin-bottom: 14px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .template {
            font-size: 1.7rem !important;
            margin: 5px 0;
        }

        .wiggle {
            color: #0f0 !important;
            display: inline-block;
            animation: .5s infinite wiggle;
        }

        .from {
            color: #eee !important;
        }

        .message {
            line-height: 1.5;
            padding: 10px;
            font-weight: bolder !important;
            color: #ff0 !important;
            opacity: 1;
            font-size: 1.51rem !important;
            margin-top: 5px;
        }

        @keyframes wiggle {
            0%, 100%, 80% { transform: rotate(0); }
            85% { transform: rotate(5deg); }
            95% { transform: rotate(-5deg); }
        }

        /* --- PANEL KONTROL MELEBAR (BOTTOM BAR) --- */
        #test-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%; 
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 20px;
            z-index: 999;
            display: flex;
            flex-direction: row; 
            align-items: center;
            gap: 15px;
            border-top: 2px solid #333;
            box-sizing: border-box;
        }

        .input-group {
            display: flex;
            flex-direction: row;
            gap: 10px;
            flex-grow: 1; 
        }

        input[type="text"] {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #555;
            background: #222;
            color: #fff;
            flex: 1; 
            min-width: 100px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-shrink: 0; 
        }
        
        button {
            background: #0f0;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            color: #000;
            font-size: 14px;
            white-space: nowrap;
        }
        
        button.manual-btn {
            background: #00d2ff;
        }

        button:hover {
            opacity: 0.8;
        }

        .img-placeholder {
            width: 100%;
            height: 200px;
            background: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            margin-bottom: 14px;
        }
    </style>
</head>
<body>

    <div id="alert-box" class="alert">
        <!-- Ganti 'thanks.gif' dengan URL gambar jika ingin pakai link online -->
        <img src="thanks.gif" class="media" id="alert-media" onerror="this.style.display='none'; document.getElementById('media-fallback').style.display='flex'">
        <div id="media-fallback" class="img-placeholder" style="display: none;">thanks.gif missing</div>

        <p class="template">
            <span class="wiggle" id="amount-text">Rp 50.000</span> 
            <span class="from">dari</span> 
            <span class="wiggle" id="supporter-name">Misterius</span>
        </p>
        <p class="message" id="message-text">Semangat streamingnya bang!</p>
    </div>

    <!-- PANEL KONTROL LENGKAP -->
    <div id="test-controls">
        <div class="input-group">
            <input type="text" id="input-name" placeholder="Nama" value="Penonton Setia">
            <input type="text" id="input-amount" placeholder="Nominal" value="IDR 10,000">
            <input type="text" id="input-message" placeholder="Pesan..." value="Halo bang, request lagu dong!">
        </div>
        <div class="btn-group">
            <button class="manual-btn" onclick="triggerManualAlert()">Kirim</button>
            <button onclick="simulateDonation()">Acak</button>
        </div>
    </div>

    <script>
        // --- DATA DUMMY ---
        const names = [
            "Sultan_Gabut", "Anak_Kos", "FansBerat01", "Kang_Bakso", 
            "User123", "SiapaHayoo", "Admin_Tobat", "Warga_Konoha", 
            "Pejuang_Rupiah", "Siti", "Budi_Ganteng", "Anonim", "Kucing_Oren"
        ];

        const amounts = [
            "IDR 10,000", "Rp 50.000", "Rp 100.000", "IDR 20,000", 
            "1000 Stars", "Rp 5.000", "500 Stars", "$5.00", "Rp 250.000"
        ];

        const messages = [
            "Semangat terus bang!",
            "Halo bang, salam dari Binjai.",
            "Request lagu dong.",
            "GGWP! Mainnya jago.",
            "Semoga harimu menyenangkan.",
            "Bang sapa aku dong!",
            "Info loker admin bang.",
            "Buat beli kopi bang.",
            "Mantap bang, lanjutkannnn!"
        ];

        // --- MANAJEMEN SUARA ---
        let availableVoices = [];
        let hideTimeout = null; 

        function updateVoiceList() {
            if(typeof speechSynthesis === 'undefined') return;
            availableVoices = window.speechSynthesis.getVoices();
        }

        if ('speechSynthesis' in window) {
            updateVoiceList();
            window.speechSynthesis.onvoiceschanged = updateVoiceList;
        }

        // --- FORMAT TEKS AGAR DIBACA NATURAL ---
        function cleanTextForSpeech(text) {
            let clean = text;
            clean = clean.replace(/IDR\s*/gi, '');
            clean = clean.replace(/Rp\.?\s*/gi, '');
            clean = clean.replace(/\$/g, ''); 
            clean = clean.replace(/,/g, ''); // Hapus koma agar "10,000" dibaca "Sepuluh Ribu"
            clean = clean.replace(/Stars/gi, 'Bintang');
            return clean;
        }

        // --- FUNGSI BICARA (PRIORITAS ONLINE) ---
        function speakText(text) {
            // METODE ONLINE: Google Translate TTS (Suara Wanita Indonesia)
            // Ini menggunakan API publik Google, jadi membutuhkan koneksi internet.
            
            const safeText = text.substring(0, 200); // Batas karakter URL
            const encodedText = encodeURIComponent(safeText);
            
            // URL ini secara default memberikan suara Cewek Indonesia
            const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=id&client=tw-ob&q=${encodedText}`;

            const audio = new Audio(url);
            
            audio.onplay = () => {
                console.log("Berhasil memutar TTS Online (Google Wanita)");
            };

            // Jika Online Gagal (Misal internet putus), baru cari offline
            audio.onerror = (e) => {
                console.warn("Gagal TTS Online, mencoba Offline.", e);
                speakTextOffline(text);
            };

            // Play audio
            audio.play().catch(e => {
                console.warn("Autoplay error (mungkin butuh interaksi user atau setting OBS), mencoba offline:", e);
                speakTextOffline(text);
            });
        }

        // --- FUNGSI CADANGAN (OFFLINE) ---
        function speakTextOffline(text) {
            if (!('speechSynthesis' in window)) return;

            window.speechSynthesis.cancel(); 
            if (availableVoices.length === 0) availableVoices = window.speechSynthesis.getVoices();

            const utterance = new SpeechSynthesisUtterance(text);
            
            // Logika Mencari Suara Wanita Offline (Jika Online Gagal)
            let selectedVoice = null;

            // 1. Cari yang namanya eksplisit wanita/gadis
            selectedVoice = availableVoices.find(v => v.lang.includes('id') && (
                v.name.includes("Gadis") || 
                v.name.includes("Wanita") || 
                v.name.includes("Female") ||
                v.name.includes("Google Bahasa Indonesia")
            ));

            // 2. Jika tidak ada, cari suara ID apapun
            if (!selectedVoice) selectedVoice = availableVoices.find(v => v.lang.includes('id'));

            if (selectedVoice) {
                utterance.voice = selectedVoice;
                console.log("Menggunakan Suara Offline: " + selectedVoice.name);
            }

            utterance.lang = 'id-ID';
            utterance.volume = 1.0; 
            utterance.rate = 1.0; 

            window.speechSynthesis.speak(utterance);
        }

        // --- LOGIKA TAMPILAN ALERT ---
        function showAlert(name, amount, message) {
            const alertBox = document.getElementById('alert-box');
            
            // Tampil
            alertBox.style.opacity = '1';
            
            // Timer 12 Detik
            if (hideTimeout) clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                alertBox.style.opacity = '0';
            }, 12000); 

            // Update Teks Layar
            document.getElementById('amount-text').innerText = amount;
            document.getElementById('supporter-name').innerText = name;
            document.getElementById('message-text').innerText = message;
            
            // Siapkan Teks untuk Dibaca
            const spokenAmount = cleanTextForSpeech(amount);
            const textToRead = `${spokenAmount} dari ${name}. ${message}`;
            
            console.log("Membaca:", textToRead); 
            speakText(textToRead);
        }

        function triggerManualAlert() {
            const name = document.getElementById('input-name').value;
            const amount = document.getElementById('input-amount').value;
            const message = document.getElementById('input-message').value;

            const finalName = name || "Anonim";
            const finalAmount = amount || "Rp 0";
            const finalMessage = message || "Tes alert manual.";

            showAlert(finalName, finalAmount, finalMessage);
        }

        function simulateDonation() {
            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];

            showAlert(randomName, randomAmount, randomMessage);
        }

        window.onload = function() {
            console.log("Overlay Loaded.");
            // Preload suara offline
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBS Alert Overlay</title>
    <style>
        /* Import Font */
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap');

        /* Reset & Body (Transparan untuk OBS) */
        html, body {
            margin: 0;
            padding: 0;
            background-color: transparent; /* Default untuk OBS */
            font-family: 'Open Sans', sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alert muncul dari atas */
            height: 100vh;
            transition: background-color 0.3s; /* Efek halus saat ganti BG testing */
        }

        /* --- CSS TAMPILAN --- */
        .alert {
            font-family: 'Open Sans', sans-serif !important;
            font-weight: 800;
            text-align: center;
            padding-top: 10px;
            text-shadow: 0 0 1px #000, 0 0 2px #000, 0 0 3px #000, 0 0 4px #000, 0 0 5px #000;
            width: 100%;
            max-width: 400px; 
            box-sizing: border-box;
            
            opacity: 0; /* Default sembunyi */
            transition: none !important;
            animation: none !important;
        }

        .media {
            max-width: 100%; 
            height: auto;
            border-radius: 10px;
            margin-bottom: 14px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .template {
            font-size: 1.7rem !important;
            margin: 5px 0;
        }

        .wiggle {
            color: #0f0 !important;
            display: inline-block;
            animation: .5s infinite wiggle;
        }

        .from {
            color: #eee !important;
        }

        .message {
            line-height: 1.5;
            padding: 10px;
            font-weight: bolder !important;
            color: #ff0 !important;
            opacity: 1;
            font-size: 1.51rem !important;
            margin-top: 5px;
        }

        @keyframes wiggle {
            0%, 100%, 80% { transform: rotate(0); }
            85% { transform: rotate(5deg); }
            95% { transform: rotate(-5deg); }
        }

        /* --- PANEL KONTROL MELEBAR (BOTTOM BAR) --- */
        #test-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%; 
            background: transparent; /* Background jadi Transparan */
            padding: 15px 20px;
            z-index: 999;
            display: flex;
            flex-direction: row; 
            align-items: center;
            gap: 15px;
            border-top: none; /* Hapus border */
            box-sizing: border-box;
        }

        .input-group {
            display: flex;
            flex-direction: row;
            gap: 10px;
            flex-grow: 1; 
        }

        input[type="text"] {
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #555;
            background: rgba(34, 34, 34, 0.8); /* Sedikit transparan pada input agar tidak terlalu mencolok */
            color: #fff;
            flex: 1; 
            min-width: 100px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-shrink: 0; 
        }
        
        button {
            background: #0f0;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            color: #000;
            font-size: 14px;
            white-space: nowrap;
        }
        
        button.manual-btn {
            background: #00d2ff;
        }

        /* Tombol Ganti Background (Orange) */
        button.bg-btn {
            background: #ff9900;
        }

        button:hover {
            opacity: 0.8;
        }

        .img-placeholder {
            width: 100%;
            height: 200px;
            background: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            margin-bottom: 14px;
        }
    </style>
</head>
<body>

    <div id="alert-box" class="alert">
        <!-- Ganti 'thanks.gif' dengan URL gambar jika ingin pakai link online -->
        <img src="thanks.gif" class="media" id="alert-media" onerror="this.style.display='none'; document.getElementById('media-fallback').style.display='flex'">
        <div id="media-fallback" class="img-placeholder" style="display: none;">thanks.gif missing</div>

        <p class="template">
            <span class="wiggle" id="amount-text">Rp 50.000</span> 
            <span class="from">dari</span> 
            <span class="wiggle" id="supporter-name">Misterius</span>
        </p>
        <p class="message" id="message-text">Semangat streamingnya bang!</p>
    </div>

    <!-- PANEL KONTROL LENGKAP -->
    <div id="test-controls">
        <div class="input-group">
            <input type="text" id="input-name" placeholder="Nama" value="Penonton Setia">
            <input type="text" id="input-amount" placeholder="Nominal" value="IDR 10,000">
            <input type="text" id="input-message" placeholder="Pesan..." value="Halo bang, request lagu dong!">
        </div>
        <div class="btn-group">
            <button class="manual-btn" onclick="triggerManualAlert()">Kirim</button>
            <button onclick="simulateDonation()">Acak</button>
            <button class="bg-btn" onclick="toggleBackground()" title="Ganti warna background untuk testing">Ganti BG</button>
        </div>
    </div>

    <script>
        // --- DATA DUMMY ---
        const names = [
            "Sultan_Gabut", "Anak_Kos", "FansBerat01", "Kang_Bakso", 
            "User123", "SiapaHayoo", "Admin_Tobat", "Warga_Konoha", 
            "Pejuang_Rupiah", "Siti", "Budi_Ganteng", "Anonim", "Kucing_Oren"
        ];

        const amounts = [
            "IDR 10,000", "Rp 50.000", "Rp 100.000", "IDR 20,000", 
            "1000 Stars", "Rp 5.000", "500 Stars", "$5.00", "Rp 250.000"
        ];

        const messages = [
            "Semangat terus bang!",
            "Halo bang, salam dari Binjai.",
            "Request lagu dong.",
            "GGWP! Mainnya jago.",
            "Semoga harimu menyenangkan.",
            "Bang sapa aku dong!",
            "Info loker admin bang.",
            "Buat beli kopi bang.",
            "Mantap bang, lanjutkannnn!"
        ];

        let hideTimeout = null; 

        // --- FITUR GANTI BACKGROUND (UNTUK TESTING DI CHROME) ---
        function toggleBackground() {
            const currentBg = document.body.style.backgroundColor;
            
            // Logika Rotasi Warna: Transparan -> Abu Gelap -> Merah Terang -> Transparan
            if (currentBg === "" || currentBg === "transparent" || currentBg === "rgba(0, 0, 0, 0)") {
                document.body.style.backgroundColor = "#333"; // Abu-abu Gelap (Biar teks kelihatan)
            } else if (currentBg === "rgb(51, 51, 51)") { // #333 dalam RGB
                document.body.style.backgroundColor = "#ff0000"; // Merah Terang (Agar kontras dengan teks hijau)
            } else {
                document.body.style.backgroundColor = "transparent"; // Kembali ke Transparan (Untuk OBS)
            }
        }

        // --- FORMAT TEKS AGAR DIBACA NATURAL ---
        function cleanTextForSpeech(text) {
            let clean = text;
            clean = clean.replace(/IDR\s*/gi, '');
            clean = clean.replace(/Rp\.?\s*/gi, '');
            clean = clean.replace(/\$/g, ''); 
            clean = clean.replace(/,/g, ''); // Hapus koma agar "10,000" dibaca "Sepuluh Ribu"
            clean = clean.replace(/Stars/gi, 'Bintang');
            return clean;
        }

        // --- FUNGSI BICARA (ONLINE ONLY - GOOGLE TTS) ---
        function speakText(text) {
            // URL Google Translate TTS (Default: Wanita Indonesia)
            const safeText = text.substring(0, 200); 
            const encodedText = encodeURIComponent(safeText);
            
            // Menggunakan client=tw-ob untuk akses publik TTS Google
            const url = `https://translate.google.com/translate_tts?ie=UTF-8&tl=id&client=tw-ob&q=${encodedText}`;

            const audio = new Audio(url);
            
            audio.onplay = () => {
                console.log("Berhasil memutar TTS Online (Google Wanita)");
            };

            audio.onerror = (e) => {
                console.error("Gagal memutar TTS. Pastikan koneksi internet aktif.", e);
            };

            audio.play().catch(e => {
                console.error("Autoplay dicegah oleh browser. Interaksi user mungkin diperlukan pertama kali.", e);
            });
        }

        // --- LOGIKA TAMPILAN ALERT ---
        function showAlert(name, amount, message) {
            const alertBox = document.getElementById('alert-box');
            
            // Tampil
            alertBox.style.opacity = '1';
            
            // Timer 12 Detik
            if (hideTimeout) clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => {
                alertBox.style.opacity = '0';
            }, 12000); 

            // Update Teks Layar
            document.getElementById('amount-text').innerText = amount;
            document.getElementById('supporter-name').innerText = name;
            document.getElementById('message-text').innerText = message;
            
            // Siapkan Teks untuk Dibaca
            const spokenAmount = cleanTextForSpeech(amount);
            const textToRead = `${spokenAmount} dari ${name}. ${message}`;
            
            console.log("Membaca:", textToRead); 
            speakText(textToRead);
        }

        function triggerManualAlert() {
            const name = document.getElementById('input-name').value;
            const amount = document.getElementById('input-amount').value;
            const message = document.getElementById('input-message').value;

            const finalName = name || "Anonim";
            const finalAmount = amount || "Rp 0";
            const finalMessage = message || "Tes alert manual.";

            showAlert(finalName, finalAmount, finalMessage);
        }

        function simulateDonation() {
            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomAmount = amounts[Math.floor(Math.random() * amounts.length)];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];

            showAlert(randomName, randomAmount, randomMessage);
        }

        window.onload = function() {
            console.log("Overlay Loaded (Online Mode Only).");
        }
    </script>
</body>
</html>
